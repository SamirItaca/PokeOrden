// ==========================
// GENERATOR
// ==========================
generator client {
  provider = "prisma-client-js"
}

// ==========================
// DATASOURCE
// ==========================
datasource db {
  provider = "postgresql"
}

// ==========================
// MODELS
// ==========================

model User {
  id        Int       @id @default(autoincrement())
  username  String    @unique
  email     String    @unique
  password  String

  teams     Team[]
  battlesP1 Battle[]  @relation("Player1")
  battlesP2 Battle[]  @relation("Player2")
  pokedex   UserPokedex[]

  createdAt DateTime  @default(now())
}

model Pokemon {
  id        Int       @id           // id oficial PokéAPI
  name      String
  image     String

  types     PokemonType[]
  teams     TeamPokemon[]
  pokedex   UserPokedex[]
}

model Type {
  id        Int       @id @default(autoincrement())
  name      String    @unique

  pokemons  PokemonType[]
}

// N:M Pokémon <-> Tipo
model PokemonType {
  pokemonId Int
  typeId    Int

  pokemon   Pokemon @relation(fields: [pokemonId], references: [id])
  type      Type    @relation(fields: [typeId], references: [id])

  @@id([pokemonId, typeId])
}

model Team {
  id        Int          @id @default(autoincrement())
  userId    Int

  user      User         @relation(fields: [userId], references: [id])
  pokemons  TeamPokemon[]

  createdAt DateTime     @default(now())
}

model TeamPokemon {
  teamId    Int
  pokemonId Int
  position  Int          // 1, 2, 3

  team      Team     @relation(fields: [teamId], references: [id])
  pokemon   Pokemon  @relation(fields: [pokemonId], references: [id])

  @@id([teamId, pokemonId])
}

model Battle {
  id         Int       @id @default(autoincrement())
  player1Id  Int
  player2Id  Int
  winnerId   Int?
  status     BattleStatus

  player1   User     @relation("Player1", fields: [player1Id], references: [id])
  player2   User     @relation("Player2", fields: [player2Id], references: [id])

  rounds    BattleRound[]

  createdAt DateTime @default(now())
}

model BattleRound {
  id             Int      @id @default(autoincrement())
  battleId       Int
  roundNumber    Int

  pokemonP1Id    Int
  pokemonP2Id    Int
  winnerPlayerId Int?

  battle         Battle   @relation(fields: [battleId], references: [id])
}

// Pokédex del usuario
model UserPokedex {
  userId     Int
  pokemonId  Int
  active     Boolean   @default(true)

  user       User      @relation(fields: [userId], references: [id])
  pokemon    Pokemon   @relation(fields: [pokemonId], references: [id])

  obtainedAt DateTime  @default(now())

  @@id([userId, pokemonId])
}

// ==========================
// ENUMS
// ==========================
enum BattleStatus {
  pending
  active
  finished
}